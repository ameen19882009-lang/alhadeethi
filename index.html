<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ Ø§Ù„ÙØ§Ø®Ø±</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Dubai:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --primary: #0a84ff;
            --danger: #ff453a;
            --success: #32d74b;
            --text: #ffffff;
            --gold: #ffd700;
        }

        body { 
            font-family: 'Dubai', sans-serif; 
            background: radial-gradient(circle at top, #1c1c1e, #000000);
            color: var(--text);
            margin: 0; padding: 15px;
            display: flex; justify-content: center;
            min-height: 100vh;
        }

        .app-container { width: 100%; max-width: 480px; }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        h2, h3 { text-align: center; color: var(--primary); margin: 10px 0; }
        .subtitle { text-align: center; font-size: 0.8em; color: #aaa; margin-bottom: 20px; }

        input {
            width: 100%; padding: 15px; margin: 10px 0;
            border-radius: 15px; border: 1px solid var(--glass-border);
            font-size: 16px; box-sizing: border-box;
            background: rgba(0, 0, 0, 0.3); color: white;
            font-family: 'Dubai'; text-align: center;
        }

        button {
            width: 100%; padding: 16px; border-radius: 15px; border: none;
            font-size: 1.1em; font-weight: bold; cursor: pointer;
            margin: 8px 0; font-family: 'Dubai'; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(10, 132, 255, 0.3); }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--glass-border); color: white; }

        button:active { transform: scale(0.95); opacity: 0.8; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        .team-box { margin: 15px 0; padding: 10px; border-radius: 15px; }
        .player-row { display: flex; align-items: center; justify-content: space-between; margin: 12px 0; }
        .player-info { display: flex; flex-direction: column; }
        .player-name { font-weight: bold; font-size: 1.1em; }
        .player-total { font-size: 0.8em; color: var(--success); }
        
        .score-input { width: 90px !important; margin: 0 !important; border-color: var(--primary); }

        .total-banner {
            text-align: center; padding: 15px; border-radius: 15px;
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--glass-border);
            transition: 0.5s;
        }

        .leader { 
            border-color: var(--danger); 
            background: rgba(255, 69, 58, 0.1);
        }
        .leader .total-num { 
            color: var(--danger); 
            font-size: 2.2em; 
            font-weight: 900;
            text-shadow: 0 0 10px rgba(255, 69, 58, 0.3);
        }

        .total-num { font-size: 1.5em; display: block; }

        /* ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .report-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
        .report-table th { padding: 12px; border-bottom: 2px solid var(--glass-border); text-align: right; color: var(--primary); }
        .report-table td { padding: 10px; border-bottom: 1px solid var(--glass-border); }
        
        .star-player { color: var(--gold); font-weight: bold; border: 1px solid var(--gold); padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
        
        .time-stamp { font-size: 0.7em; color: #888; display: block; }

        .game-badge { background: var(--primary); padding: 2px 10px; border-radius: 20px; font-size: 0.7em; vertical-align: middle; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="scr_welcome" class="glass-card">
        <h2>ğŸ€„ Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ</h2>
        <p class="subtitle">ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø£Ù…ÙŠÙ† Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ â€¢ 2024</p>
        <button class="btn-primary" onclick="navTo('scr_setup')">Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <div id="scr_setup" class="glass-card" style="display:none;">
        <h3>ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙØ±Ù‚</h3>
        <input type="text" id="t1_name" placeholder="Ø§Ø³Ù… ÙØ±ÙŠÙ‚ Ø§Ù„ØµÙ‚ÙˆØ±">
        <div style="display:flex; gap:10px;">
            <input type="text" id="t1_p1" placeholder="Ù„Ø§Ø¹Ø¨ 1">
            <input type="text" id="t1_p2" placeholder="Ù„Ø§Ø¹Ø¨ 2">
        </div>
        <hr style="opacity:0.1; margin:15px 0;">
        <input type="text" id="t2_name" placeholder="Ø§Ø³Ù… ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø³ÙˆØ¯">
        <div style="display:flex; gap:10px;">
            <input type="text" id="t2_p1" placeholder="Ù„Ø§Ø¹Ø¨ 3">
            <input type="text" id="t2_p2" placeholder="Ù„Ø§Ø¹Ø¨ 4">
        </div>
        <button class="btn-primary" onclick="initGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„</button>
    </div>

    <div id="scr_game" class="glass-card" style="display:none;">
        <div style="text-align:center; margin-bottom:15px;">
            <span class="game-badge">Ø§Ù„Ø´ÙˆØ· Ø±Ù‚Ù… <span id="game_count">1</span></span>
        </div>

        <div class="team-box">
            <h4 id="disp_t1_n" style="margin:0; color:var(--primary)"></h4>
            <div class="player-row">
                <div class="player-info">
                    <span id="disp_t1_p1" class="player-name"></span>
                    <span class="player-total">Ù…Ø¬Ù…ÙˆØ¹Ù‡: <span id="p1_sum">0</span></span>
                </div>
                <input type="number" inputmode="numeric" id="in_p1" class="score-input" placeholder="0">
            </div>
            <div class="player-row">
                <div class="player-info">
                    <span id="disp_t1_p2" class="player-name"></span>
                    <span class="player-total">Ù…Ø¬Ù…ÙˆØ¹Ù‡: <span id="p2_sum">0</span></span>
                </div>
                <input type="number" inputmode="numeric" id="in_p2" class="score-input" placeholder="0">
            </div>
            <div id="box_t1" class="total-banner">
                <span style="font-size:0.8em">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±ÙŠÙ‚</span>
                <span id="val_t1" class="total-num">0</span>
            </div>
        </div>

        <div style="height:1px; background:var(--glass-border); margin:20px 0;"></div>

        <div class="team-box">
            <h4 id="disp_t2_n" style="margin:0; color:var(--primary)"></h4>
            <div class="player-row">
                <div class="player-info">
                    <span id="disp_t2_p1" class="player-name"></span>
                    <span class="player-total">Ù…Ø¬Ù…ÙˆØ¹Ù‡: <span id="p3_sum">0</span></span>
                </div>
                <input type="number" inputmode="numeric" id="in_p3" class="score-input" placeholder="0">
            </div>
            <div class="player-row">
                <div class="player-info">
                    <span id="disp_t2_p2" class="player-name"></span>
                    <span class="player-total">Ù…Ø¬Ù…ÙˆØ¹Ù‡: <span id="p4_sum">0</span></span>
                </div>
                <input type="number" inputmode="numeric" id="in_p4" class="score-input" placeholder="0">
            </div>
            <div id="box_t2" class="total-banner">
                <span style="font-size:0.8em">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±ÙŠÙ‚</span>
                <span id="val_t2" class="total-num">0</span>
            </div>
        </div>

        <button class="btn-success" style="margin-top:20px" onclick="recordScores()">ØªØ³Ø¬ÙŠÙ„ ÙˆØ¯ÙØ¹</button>
    </div>

    <div id="scr_after" style="display:none;">
        <div class="glass-card" style="text-align:center;">
            <h1 id="win_title" style="margin:0; font-size:2.5em;">ğŸ‰</h1>
            <h2 id="win_name">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²</h2>
            <button class="btn-primary" onclick="generateDetailedReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„</button>
            <button class="btn-outline" onclick="nextRound()">Ø´ÙˆØ· Ø¬Ø¯ÙŠØ¯ (Ù†ÙØ³ Ø§Ù„ÙØ±Ù‚)</button>
            <button class="btn-outline" onclick="location.reload()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
        </div>
    </div>

    <div id="scr_report" class="glass-card" style="display:none; background: #000; padding: 0;">
        <div id="capture_area" style="padding:30px; background: linear-gradient(135deg, #1a1a1a 0%, #000 100%);">
            <h2 style="margin:0">ØªÙ‚Ø±ÙŠØ± Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ</h2>
            <p id="rep_meta" style="color:#666; font-size:0.8em; margin-bottom:20px;"></p>
            
            <div id="rep_summary" style="display:flex; justify-content: space-around; text-align:center; margin-bottom:20px;"></div>
            
            <div id="rep_star" style="text-align:center; margin-bottom:20px;"></div>

            <table class="report-table">
                <thead>
                    <tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr>
                </thead>
                <tbody id="rep_body"></tbody>
            </table>
            
            <p style="text-align:center; margin-top:30px; font-size:0.7em; color:var(--primary);">ØªØ·Ø¨ÙŠÙ‚ Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ â€¢ ØªØµÙ…ÙŠÙ… Ù…. Ø£Ù…ÙŠÙ† Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ</p>
        </div>
        <div style="padding:20px;">
            <button class="btn-success" onclick="saveReportImage()">Ø­ÙØ¸ ÙƒØµÙˆØ±Ø© Ø·ÙˆÙŠÙ„Ø©</button>
            <button class="btn-outline" onclick="navTo('scr_game')">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>
</div>

<script>
    let session = {
        round: 1,
        t1: { name: "", p: ["", ""], score: 0, pScores: [0, 0] },
        t2: { name: "", p: ["", ""], score: 0, pScores: [0, 0] },
        log: []
    };

    function navTo(id) {
        document.querySelectorAll('.app-container > div').forEach(d => d.style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function initGame() {
        session.t1.name = document.getElementById('t1_name').value || "ÙØ±ÙŠÙ‚ 1";
        session.t1.p = [document.getElementById('t1_p1').value || "Ù„Ø§Ø¹Ø¨ 1", document.getElementById('t1_p2').value || "Ù„Ø§Ø¹Ø¨ 2"];
        session.t2.name = document.getElementById('t2_name').value || "ÙØ±ÙŠÙ‚ 2";
        session.t2.p = [document.getElementById('t2_p1').value || "Ù„Ø§Ø¹Ø¨ 3", document.getElementById('t2_p2').value || "Ù„Ø§Ø¹Ø¨ 4"];
        
        updateGameUI();
        navTo('scr_game');
    }

    function recordScores() {
        let vals = [
            Number(document.getElementById('in_p1').value) || 0,
            Number(document.getElementById('in_p2').value) || 0,
            Number(document.getElementById('in_p3').value) || 0,
            Number(document.getElementById('in_p4').value) || 0
        ];

        let time = new Date().toLocaleTimeString("ar-EG", {minute:'2-digit', second:'2-digit'});

        vals.forEach((v, i) => {
            if(v > 0) {
                let pName = i < 2 ? session.t1.p[i] : session.t2.p[i-2];
                session.log.push({ name: pName, val: v, time: time });
                if(i < 2) {
                    session.t1.pScores[i] += v;
                    session.t1.score += v;
                } else {
                    session.t2.pScores[i-2] += v;
                    session.t2.score += v;
                }
            }
        });

        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        for(let i=1; i<=4; i++) document.getElementById('in_p'+i).value = "";
        
        updateGameUI();
        checkWin();
    }

    function updateGameUI() {
        document.getElementById('game_count').innerText = session.round;
        document.getElementById('disp_t1_n').innerText = session.t1.name;
        document.getElementById('disp_t1_p1').innerText = session.t1.p[0];
        document.getElementById('disp_t1_p2').innerText = session.t1.p[1];
        document.getElementById('p1_sum').innerText = session.t1.pScores[0];
        document.getElementById('p2_sum').innerText = session.t1.pScores[1];
        document.getElementById('val_t1').innerText = session.t1.score;

        document.getElementById('disp_t2_n').innerText = session.t2.name;
        document.getElementById('disp_t2_p1').innerText = session.t2.p[0];
        document.getElementById('disp_t2_p2').innerText = session.t2.p[1];
        document.getElementById('p3_sum').innerText = session.t2.pScores[0];
        document.getElementById('p4_sum').innerText = session.t2.pScores[1];
        document.getElementById('val_t2').innerText = session.t2.score;

        const b1 = document.getElementById('box_t1');
        const b2 = document.getElementById('box_t2');
        b1.classList.remove('leader'); b2.classList.remove('leader');

        if(session.t1.score > session.t2.score) b1.classList.add('leader');
        else if(session.t2.score > session.t1.score) b2.classList.add('leader');
    }

    function checkWin() {
        if(session.t1.score >= 151 || session.t2.score >= 151) {
            let winner = session.t1.score >= 151 ? session.t1.name : session.t2.name;
            document.getElementById('win_name').innerText = winner;
            navTo('scr_after');
        }
    }

    function nextRound() {
        session.round++;
        session.t1.score = 0; session.t1.pScores = [0,0];
        session.t2.score = 0; session.t2.pScores = [0,0];
        session.log = [];
        updateGameUI();
        navTo('scr_game');
    }

    function generateDetailedReport() {
        document.getElementById('rep_meta').innerText = `Ø§Ù„Ø´ÙˆØ· Ø±Ù‚Ù… ${session.round} â€¢ ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString("ar-EG")}`;
        
        document.getElementById('rep_summary').innerHTML = `
            <div><h3 style="margin:0">${session.t1.score}</h3><small>${session.t1.name}</small></div>
            <div style="font-size:1.5em; opacity:0.3">VS</div>
            <div><h3 style="margin:0">${session.t2.score}</h3><small>${session.t2.name}</small></div>
        `;

        // Ø­Ø³Ø§Ø¨ Ø£ÙØ¶Ù„ Ù„Ø§Ø¹Ø¨
        let totals = {};
        session.log.forEach(l => totals[l.name] = (totals[l.name] || 0) + l.val);
        let bestPlayer = Object.keys(totals).reduce((a, b) => totals[a] > totals[b] ? a : b);

        document.getElementById('rep_star').innerHTML = `
            <div class="star-player">ğŸŒŸ Ù†Ø¬Ù… Ø§Ù„Ø´ÙˆØ·: ${bestPlayer} (Ø¬Ù…Ø¹ ${totals[bestPlayer]} Ù†Ù‚Ø·Ø©)</div>
        `;

        let rows = session.log.map(l => `
            <tr>
                <td><span class="time-stamp">${l.time}</span></td>
                <td>${l.name}</td>
                <td style="color:var(--primary); font-weight:bold;">+${l.val}</td>
            </tr>
        `).reverse().join('');
        
        document.getElementById('rep_body').innerHTML = rows;
        navTo('scr_report');
    }

    function saveReportImage() {
        const area = document.getElementById('capture_area');
        html2canvas(area, { scale: 3, backgroundColor: '#000000' }).then(canvas => {
            const link = document.createElement('a');
            link.download = `ØªÙ‚Ø±ÙŠØ±_Ø¯ÙˆÙ…ÙŠÙ†Ùˆ_Ø´ÙˆØ·_${session.round}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>

</body>
</html>
