<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Dubai:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #007aff;
            --secondary: #5856d6;
            --danger: #ff3b30;
            --success: #34c759;
            --bg: #f2f2f7;
            --card: #ffffff;
            --text: #1c1c1e;
        }

        body { 
            font-family: 'Dubai', sans-serif; 
            background-color: var(--bg); 
            color: var(--text);
            margin: 0; 
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 450px;
        }

        .card {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        h2 { color: var(--primary); text-align: center; margin-top: 0; }
        p { text-align: center; color: #666; font-size: 0.9em; }

        input {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border-radius: 12px;
            border: 1px solid #ddd;
            font-size: 16px; /* Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙˆÙ… ÙÙŠ Ø§Ù„Ø¢ÙŠÙÙˆÙ† */
            box-sizing: border-box;
            background: #f9f9f9;
            font-family: 'Dubai';
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            background: #fff;
        }

        button {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px 0;
            font-family: 'Dubai';
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }

        button:active { transform: scale(0.98); opacity: 0.9; }

        .team-section {
            border-right: 4px solid var(--primary);
            padding-right: 15px;
            margin: 20px 0;
        }

        .team-section.team2 { border-color: var(--secondary); }

        .score-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
        }

        .player-label { font-weight: bold; font-size: 1.1em; flex: 1; }
        .score-input { width: 80px !important; text-align: center; margin: 0 !important; }

        .total-display {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            font-size: 1.1em;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        /* ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…ØªØµØ¯Ø± */
        .leader {
            color: var(--danger) !important;
            font-size: 1.8em !important;
            font-weight: 900;
            background: #fff0f0;
            border: 1px solid #ffcccc;
        }

        .winner-banner {
            background: var(--success);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5em;
            margin-bottom: 20px;
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .results-table th, .results-table td {
            padding: 12px;
            border: 1px solid #eee;
            text-align: center;
        }

        .results-table th { background: #f4f4f4; }

        .export-area { background: white; padding: 20px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="welcome" class="card">
        <h2>ğŸ€„ Ø¯ÙˆÙ…ÙŠÙ†Ùˆ Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ</h2>
        <p>ØªØ­ÙŠØ© Ø®Ø§ØµØ© Ù„Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø£Ù…ÙŠÙ† Ø§Ù„Ø­Ø¯ÙŠØ«ÙŠ ğŸŒŸ<br>ØµÙ„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ÙˆÙŠÙ„Ø§ Ù†Ø¨Ù„Ø´!</p>
        <button class="btn-primary" onclick="showScreen('team1')">Ø§Ø¨Ø¯Ø£ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>

    <div id="team1" class="card" style="display:none;">
        <h3>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</h3>
        <input type="text" id="team1name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„ØµÙ‚ÙˆØ±)">
        <input type="text" id="t1p1" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„">
        <input type="text" id="t1p2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ">
        <button class="btn-primary" onclick="showScreen('team2')">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>

    <div id="team2" class="card" style="display:none;">
        <h3>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</h3>
        <input type="text" id="team2name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø£Ø¨Ø·Ø§Ù„)">
        <input type="text" id="t2p1" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„">
        <input type="text" id="t2p2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ">
        <button class="btn-primary" onclick="startGame()">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨</button>
    </div>

    <div id="game" class="card" style="display:none;">
        <div id="gameTime" style="text-align:center; font-size:0.8em; color:#888; margin-bottom:10px;"></div>
        
        <div class="team-section">
            <h4 id="displayT1Name" style="margin:0"></h4>
            <div class="score-row">
                <span id="displayT1P1" class="player-label"></span>
                <input type="number" inputmode="numeric" id="t1p1score" class="score-input" placeholder="0">
            </div>
            <div class="score-row">
                <span id="displayT1P2" class="player-label"></span>
                <input type="number" inputmode="numeric" id="t1p2score" class="score-input" placeholder="0">
            </div>
            <div id="t1TotalBox" class="total-display">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="team1total">0</span></div>
        </div>

        <hr style="border: 0; height: 1px; background: #eee; margin: 20px 0;">

        <div class="team-section team2">
            <h4 id="displayT2Name" style="margin:0"></h4>
            <div class="score-row">
                <span id="displayT2P1" class="player-label"></span>
                <input type="number" inputmode="numeric" id="t2p1score" class="score-input" placeholder="0">
            </div>
            <div class="score-row">
                <span id="displayT2P2" class="player-label"></span>
                <input type="number" inputmode="numeric" id="t2p2score" class="score-input" placeholder="0">
            </div>
            <div id="t2TotalBox" class="total-display">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="team2total">0</span></div>
        </div>

        <button class="btn-success" style="margin-top:20px;" onclick="addScores()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
    </div>

    <div id="afterGame" style="display:none;">
        <div id="winnerMsg"></div>
        <div class="card">
            <button class="btn-primary" onclick="showResults()">Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button class="btn-outline" onclick="startExtraGame()">Ø¬ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙÙŠØ© (Ù†ÙØ³ Ø§Ù„ÙØ±Ù‚)</button>
            <button class="btn-outline" style="color:var(--danger); border-color:var(--danger)" onclick="location.reload()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
        </div>
    </div>

    <div id="result" class="card" style="display:none;">
        <div id="captureArea" class="export-area">
            <h2 style="color:black">ØªÙ‚Ø±ÙŠØ± Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ</h2>
            <div id="reportContent"></div>
        </div>
        <button class="btn-success" onclick="exportAsImage()">Ø­ÙØ¸ ÙƒØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ</button>
        <button class="btn-outline" onclick="showScreen('game')">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø¨</button>
    </div>
</div>

<script>
let team1 = {name:"", players:["",""], scores:[0,0]};
let team2 = {name:"", players:["",""], scores:[0,0]};
let pointsHistory = [];
let allGames = [];
let startTime;

function showScreen(screenId) {
    const screens = ['welcome', 'team1', 'team2', 'game', 'afterGame', 'result'];
    screens.forEach(s => document.getElementById(s).style.display = 'none');
    document.getElementById(screenId).style.display = 'block';
}

function startGame() {
    team1.name = document.getElementById("team1name").value || "Ø§Ù„ÙØ±ÙŠÙ‚ 1";
    team1.players = [document.getElementById("t1p1").value || "Ù„Ø§Ø¹Ø¨ 1", document.getElementById("t1p2").value || "Ù„Ø§Ø¹Ø¨ 2"];
    
    team2.name = document.getElementById("team2name").value || "Ø§Ù„ÙØ±ÙŠÙ‚ 2";
    team2.players = [document.getElementById("t2p1").value || "Ù„Ø§Ø¹Ø¨ 1", document.getElementById("t2p2").value || "Ù„Ø§Ø¹Ø¨ 2"];

    document.getElementById("displayT1Name").innerText = team1.name;
    document.getElementById("displayT2Name").innerText = team2.name;
    document.getElementById("displayT1P1").innerText = team1.players[0];
    document.getElementById("displayT1P2").innerText = team1.players[1];
    document.getElementById("displayT2P1").innerText = team2.players[0];
    document.getElementById("displayT2P2").innerText = team2.players[1];
    
    startTime = new Date();
    document.getElementById("gameTime").innerText = "Ø¨Ø¯Ø£Øª ÙÙŠ: " + startTime.toLocaleTimeString("ar-EG");
    
    showScreen('game');
}

function addScores() {
    let s1 = Number(document.getElementById("t1p1score").value) || 0;
    let s2 = Number(document.getElementById("t1p2score").value) || 0;
    let s3 = Number(document.getElementById("t2p1score").value) || 0;
    let s4 = Number(document.getElementById("t2p2score").value) || 0;

    let now = new Date().toLocaleTimeString("ar-EG");
    if(s1) pointsHistory.push({team: team1.name, player: team1.players[0], val: s1, time: now});
    if(s2) pointsHistory.push({team: team1.name, player: team1.players[1], val: s2, time: now});
    if(s3) pointsHistory.push({team: team2.name, player: team2.players[0], val: s3, time: now});
    if(s4) pointsHistory.push({team: team2.name, player: team2.players[1], val: s4, time: now});

    team1.scores[0] += s1; team1.scores[1] += s2;
    team2.scores[0] += s3; team2.scores[1] += s4;

    updateUI();
    
    // Ù…Ø³Ø­ Ø§Ù„Ø®Ø§Ù†Ø§Øª
    ['t1p1score','t1p2score','t2p1score','t2p2score'].forEach(id => document.getElementById(id).value = "");
}

function updateUI() {
    let total1 = team1.scores[0] + team1.scores[1];
    let total2 = team2.scores[0] + team2.scores[1];

    document.getElementById("team1total").innerText = total1;
    document.getElementById("team2total").innerText = total2;

    // ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø¹Ù„Ù‰
    const box1 = document.getElementById("t1TotalBox");
    const box2 = document.getElementById("t2TotalBox");

    box1.classList.remove("leader");
    box2.classList.remove("leader");

    if (total1 > total2) box1.classList.add("leader");
    else if (total2 > total1) box2.classList.add("leader");

    if (total1 >= 151 || total2 >= 151) {
        endGame(total1, total2);
    }
}

function endGame(t1, t2) {
    let winner = t1 >= 151 ? team1.name : team2.name;
    document.getElementById("winnerMsg").innerHTML = `<div class="winner-banner">ğŸ† ÙƒÙÙˆ! Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ: ${winner} ğŸ†</div>`;
    
    allGames.push({
        t1Name: team1.name, t2Name: team2.name,
        t1Score: t1, t2Score: t2,
        history: [...pointsHistory],
        winner: winner,
        date: new Date().toLocaleString("ar-EG")
    });
    
    showScreen('afterGame');
}

function showResults() {
    let lastGame = allGames[allGames.length - 1];
    let historyHtml = lastGame.history.map(h => `
        <tr>
            <td>${h.team}</td>
            <td>${h.player}</td>
            <td style="color:var(--danger); font-weight:bold
